# RSV Core モジュール - README作成方針

## 必要なセクション

1. **概要（Overview）**
   - コアモジュールの主な目的と役割
   - システム全体における位置づけ
   - 主要な機能の簡単な説明

2. **システム要件（Requirements）**
   - PHPバージョン
   - 必要な拡張機能
   - その他の依存関係

3. **主要コンポーネント（Core Components）**
   - Database.class.php: データベース接続と操作
   - SessionManager.class.php: セッション管理
   - AbstractRecord/Table: データモデルの基底クラス
   - UserRole: ユーザー権限管理
   - Utility関数群

4. **ディレクトリ構造（Directory Structure）**
   ```
   core/
   ├── records/     # レコードクラス群
   ├── tables/      # テーブルクラス群
   ├── Database.class.php
   ├── SessionManager.class.php
   └── ...
   ```

5. **セットアップ手順（Setup）**
   - 初期化方法
   - 設定ファイルの説明
   - データベース接続設定

6. **使用方法（Usage）**
   - 基本的な使用例
   - コード例
   - 主要なAPIの説明

7. **セキュリティ（Security）**
   - セッション管理のベストプラクティス
   - データベースセキュリティ
   - ユーザー認証・認可

8. **貢献（Contributing）**
   - コーディング規約
   - プルリクエストの手順
   - テスト要件

9. **ライセンス（License）**
   - ライセンス情報

## 作成時の注意点

1. 各セクションは簡潔かつ明確に記述
2. コード例は実際の使用シーンを想定
3. セキュリティ関連の情報は詳細に記載
4. 初めて見る開発者でもわかるような説明を心がける
5. 日本語・英語のバイリンガル対応を検討

## 次のステップ

1. 各コンポーネントの詳細な調査
2. 実際のユースケースの収集
3. セキュリティ要件の確認
4. APIドキュメントの作成方針の決定

## クラス内ドキュメンテーション方針

### 基本方針
- PHPDocを使用して、すべてのクラス、メソッド、プロパティにドキュメントを付与
- 日本語でのコメントを基本とし、必要に応じて英語を併記
- コードの「なぜ」を説明することを重視

### クラスドキュメント
```php
/**
 * データベースレコードの基底クラス
 * 
 * すべてのレコードクラスの親クラスとして機能し、
 * 基本的なCRUD操作とバリデーション機能を提供します。
 * 
 * @package RSV\Core
 * @author  開発者名
 * @version 1.0.0
 */
```

### メソッドドキュメント
```php
/**
 * レコードをデータベースに保存します
 * 
 * @access protected
 * @static
 * @param array $data 保存するデータの連想配列
 *     [
 *         'field_name' => 値,
 *         'created_at' => DateTime,
 *         ...
 *     ]
 * @return bool 保存成功時true、失敗時false
 * @throws DatabaseException データベース接続エラー時
 * 
 * @note protectedである理由:
 *     - 直接のデータ操作を制限し、バリデーション付きのpublicメソッドを経由させるため
 * 
 * @note staticである理由:
 *     - インスタンス状態に依存せず、一貫した保存処理を提供するため
 *     - バッチ処理などで複数レコードを効率的に処理するため
 */
```

### 重要な記載項目
1. **アクセス修飾子の説明**
   - protectedやprivateを使用する理由
   - カプセル化の意図
   - 想定される使用パターン

2. **static修飾子の説明**
   - staticメソッドを選択した理由
   - インスタンス状態との関係
   - パフォーマンスへの影響

3. **引数の詳細な仕様**
   - 配列の構造（連想配列のキーと値の型）
   - 必須項目と任意項目の区別
   - 値の制約条件（フォーマット、範囲など）

4. **戻り値の説明**
   - 返却値の型と構造
   - nullableな場合の条件
   - エラー時の挙動

5. **例外処理**
   - 発生する可能性のある例外
   - 例外発生の条件
   - 例外へのハンドリング方法

6. **依存関係**
   - 他のクラスやメソッドとの関係
   - 必要な前提条件
   - 影響を与える範囲

### レビュー時の確認項目
1. ドキュメントが最新のコードと一致しているか
2. 必要な情報が漏れなく記載されているか
3. 説明が明確で理解しやすいか
4. 例示が適切で十分か
5. タイプヒントと説明が一致しているか

## ドキュメント階層と役割分担

### プロジェクトREADME（トップレベル）
- **役割**: プロジェクト全体の概要と導入
- **対象読者**: 新規開発者、プロジェクト管理者、外部レビュアー
- **記載内容**:
  - プロジェクトの目的と価値
  - アーキテクチャの概要
  - セットアップ手順
  - 主要コンポーネントの関係性
  - ライセンスと貢献方法
- **更新頻度**: 主要な機能追加・アーキテクチャ変更時

### クラスドキュメント（中間レベル）
- **役割**: クラスの責務と設計意図の説明
- **対象読者**: 実装担当の開発者
- **記載内容**:
  - クラスの主要な責務
  - 継承関係と依存関係
  - 設計パターンの採用理由
  - インスタンス化ポリシー
  - スレッド安全性
  - メモリ使用に関する注意事項
- **更新頻度**: クラスの仕様変更時

### メソッドドキュメント（詳細レベル）
- **役割**: 実装詳細とAPI仕様の説明
- **対象読者**: APIを利用する開発者
- **記載内容**:
  - メソッドの機能説明
  - パラメータと戻り値の詳細
  - 例外条件
  - 使用例
  - パフォーマンス特性
- **更新頻度**: メソッドの修正時

### 追加の留意事項

1. **重複を避ける**
   - 各レベルで適切な抽象度を保つ
   - 上位レベルでは詳細を省き、必要に応じて下位レベルへリンク
   - 同じ情報を複数箇所に記載しない

2. **一貫性の維持**
   - 用語の統一（用語集の作成を推奨）
   - フォーマットの統一
   - 命名規則の統一

3. **バージョン管理**
   - 重要な変更履歴の記録
   - 非推奨（deprecated）の明示
   - 後方互換性に関する注意事項

4. **コードとの同期**
   - CIでのドキュメント検証
   - コードレビュー時のドキュメントレビュー
   - 自動生成ドキュメントの活用

5. **メンテナンス性**
   - ドキュメント更新の自動化
   - テストケースとの連携
   - レビュープロセスの確立

### ドキュメント間の相互参照
- README → クラス: アーキテクチャ上の役割の説明
- クラス → メソッド: 実装の詳細な説明
- メソッド → テスト: 具体的な使用例の提示

### 優先度の指針
1. **最優先で記載すべき情報**
   - セキュリティに関する注意事項
   - データ整合性に関する制約
   - パフォーマンスに重大な影響を与える要素

2. **できるだけ記載すべき情報**
   - 設計判断の理由
   - 非自明な実装の説明
   - 既知の制限事項

3. **状況に応じて記載する情報**
   - 実装の詳細な背景
   - 代替案の検討過程
   - 将来の展望

## 用語集（Glossary）

### システム全般
- **RSV**: Reservation System（予約システム）の略称
- **コアモジュール**: システムの中核となる機能を提供するモジュール群
- **フロントエンド**: ユーザーインターフェースを提供するシステムの部分
- **バックエンド**: データ処理やビジネスロジックを担当するシステムの部分

### データベース関連
- **レコード**: データベースのテーブルの1行を表すオブジェクト
- **テーブル**: データベースにおけるデータの集合を管理する構造
- **CRUD**: Create（作成）、Read（読取）、Update（更新）、Delete（削除）の略
- **クエリ**: データベースに対する問い合わせや操作の命令
- **トランザクション**: 複数のデータベース操作をまとめた一連の処理単位

### セッション管理
- **セッション**: ユーザーの状態を保持する一時的なデータ構造
- **認証**: ユーザーの身元を確認するプロセス
- **認可**: ユーザーの権限を確認するプロセス
- **トークン**: ユーザーの認証状態を示す一意の識別子

### クラス構造
- **抽象クラス**: 直接インスタンス化できない、機能の雛形を提供するクラス
- **具象クラス**: 実際にインスタンス化して使用できるクラス
- **インターフェース**: クラスが実装すべきメソッドを定義する契約
- **列挙型**: 予め定義された値の集合を表現する型

### デザインパターン
- **シングルトン**: クラスのインスタンスが1つだけ存在することを保証するパターン
- **ファクトリー**: オブジェクトの生成を専門に行うクラスを用いるパターン
- **オブザーバー**: オブジェクト間の1対多の依存関係を定義するパターン
- **ストラテジー**: アルゴリズムを実行時に切り替え可能にするパターン

### セキュリティ
- **サニタイズ**: 入力データから危険な要素を除去する処理
- **バリデーション**: 入力データの妥当性を検証する処理
- **エスケープ**: 特殊文字を安全な形式に変換する処理
- **CSRF**: Cross-Site Request Forgery（クロスサイトリクエストフォージェリ）

### 開発プロセス
- **CI/CD**: 継続的インテグレーション/継続的デリバリー
- **ユニットテスト**: 個々のコンポーネントの機能をテストする手法
- **統合テスト**: 複数のコンポーネントの連携をテストする手法
- **デプロイ**: システムを本番環境に配置し、利用可能な状態にすること

### パフォーマンス
- **キャッシュ**: 頻繁に使用するデータを高速にアクセスできる場所に保持する仕組み
- **インデックス**: データベースの検索を高速化するための補助的なデータ構造
- **クエリ最適化**: データベースの問い合わせを効率的に実行できるように改善すること
- **負荷分散**: システムの処理負荷を複数のサーバーに分散させること

### 注意事項
1. この用語集は開発チーム内で統一した用語の使用を促進するためのものです
2. 新しい用語を追加する際は、チーム内でレビューを行ってください
3. 用語の定義は定期的に見直し、必要に応じて更新してください
4. 英語と日本語の対応関係を明確にし、ドキュメント作成時の参考としてください


## 仕様変更ガイド

### 機能拡張ポイント
```php
/**
 * 予約機能の拡張ポイント
 * 
 * @extension_points
 * 1. 予約項目の追加
 *    - entity/ReservationRecord.class.php:
 *      - schema()メソッド: 新規フィールドの定義を追加
 *      - validate()メソッド: バリデーションルールを追加
 *    - tables/ReservationTable.class.php:
 *      - search()メソッド: 検索条件に新規フィールドを追加
 * 
 * 2. 予約ステータスの追加
 *    - UserRole.enum.php: 新規ロールの追加
 *    - SessionManager.class.php:
 *      - checkPermission()メソッド: 権限チェックロジックを更新
 * 
 * 3. 通知機能の追加
 *    - utilFunctions.php: 通知用ユーティリティ関数を追加
 *    - entity/ReservationRecord.class.php:
 *      - afterSave()メソッド: 通知トリガーを実装
 */
```

### データベース構造の拡張
```php
/**
 * データベース拡張ガイド
 * 
 * @database_extension
 * 1. テーブル追加
 *    - core/tables/に新規Tableクラスを作成
 *    - core/entity/に新規Recordクラスを作成
 *    - Database.class.php: テーブル初期化処理に追加
 * 
 * 2. リレーション追加
 *    - 関連するRecordクラスのrelations()メソッドを更新
 *    - 外部キー制約を適切に設定
 * 
 * 3. インデックス最適化
 *    - createTable()メソッド: 検索パターンに応じたインデックスを追加
 */
```

### セキュリティ設定の変更
```php
/**
 * セキュリティ設定の拡張ガイド
 * 
 * @security_extension
 * 1. 認証ルールの追加
 *    - SessionManager.class.php:
 *      - validateSession()メソッド: 新規認証ルールを追加
 *      - login()メソッド: 認証処理を拡張
 * 
 * 2. アクセス制御の変更
 *    - AbstractRecord.class.php:
 *      - checkAccess()メソッド: アクセス制御ロジックを更新
 */
```

### バリデーションルールの追加
```php
/**
 * バリデーション拡張ガイド
 * 
 * @validation_extension
 * 1. 共通バリデーションの追加
 *    - AbstractRecord.class.php:
 *      - commonRules()メソッド: 共通ルールを追加
 * 
 * 2. カスタムバリデータの追加
 *    - utilFunctions.php: バリデーション関数を追加
 *    - 対象のRecordクラス: rules()メソッドで利用
 */
```

### 注意事項
1. 拡張ポイントは実装の意図を理解した上で選択する
2. 既存の抽象化レベルを維持する
3. 後方互換性を考慮する
4. 変更後のテストケース追加を忘れない

### 推奨プラクティス
1. 拡張前に既存の同様の実装を参考にする
2. 複数の拡張方法がある場合は、最も影響範囲が小さい方法を選択
3. 拡張時に既存機能への影響を最小限に抑える
4. 必要に応じてリファクタリングを検討する
